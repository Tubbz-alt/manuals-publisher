#!/usr/bin/env ruby

require File.expand_path('../../config/environment', __FILE__)

abort("Usage: bin/cma_importer content_directory") if ARGV.empty? || !File.directory?(ARGV.first)

require 'pathname'
content_directory = Pathname.new(ARGV.first)

require 'uri'
require 'cma_importer'

Pathname.glob("#{content_directory}/*.json").each do |case_file|
  puts "Processing #{case_file}"
  case_data = JSON.parse(case_file.read)

  CMAImporter::DocumentImporter.new(content_directory, case_data, case_file.path).import
end
